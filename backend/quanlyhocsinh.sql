DROP DATABASE IF EXISTS quanlyhocsinh;
CREATE DATABASE quanlyhocsinh CHARACTER SET utf8mb4 COLLATE utf8mb4_vietnamese_ci;
USE quanlyhocsinh;

-- Tạo bảng NAMHOC
CREATE TABLE NAMHOC (
    MaNamHoc VARCHAR(255) PRIMARY KEY,
    Nam1 INT NOT NULL,
    Nam2 INT NOT NULL
);

-- Tạo bảng KHOILOP
CREATE TABLE KHOILOP (
    MaKhoi INT AUTO_INCREMENT PRIMARY KEY,
    TenKhoi NVARCHAR(50) NOT NULL
);

-- Tạo bảng LOP
CREATE TABLE LOP (
    MaLop INT AUTO_INCREMENT PRIMARY KEY,
    TenLop NVARCHAR(50) NOT NULL,
    MaKhoi INT NOT NULL,
    FOREIGN KEY (MaKhoi) REFERENCES KHOILOP(MaKhoi) ON DELETE CASCADE
);

-- Tạo bảng DANHSACHLOP
CREATE TABLE DANHSACHLOP (
    MaDanhSachLop INT AUTO_INCREMENT PRIMARY KEY,
    MaNamHoc VARCHAR(255) NOT NULL,
    MaLop INT NOT NULL,
    SiSo INT NOT NULL,
    FOREIGN KEY (MaNamHoc) REFERENCES NAMHOC(MaNamHoc) ON DELETE CASCADE,
    FOREIGN KEY (MaLop) REFERENCES LOP(MaLop) ON DELETE CASCADE
);

-- Tạo bảng HOCSINH với cột GioiTinh
CREATE TABLE HOCSINH (
    MaHocSinh INT AUTO_INCREMENT PRIMARY KEY,
    TenHocSinh NVARCHAR(50) NOT NULL,
    NgaySinh DATE NOT NULL,
    DiaChi NVARCHAR(100),
    Email NVARCHAR(100),
    GioiTinh NVARCHAR(10) NOT NULL
);

-- Tạo bảng CT_DSL
CREATE TABLE CT_DSL (
    MaCT_DSL INT AUTO_INCREMENT PRIMARY KEY,
    MaDanhSachLop INT NOT NULL,
    MaHocSinh INT NOT NULL,
    FOREIGN KEY (MaDanhSachLop) REFERENCES DANHSACHLOP(MaDanhSachLop) ON DELETE CASCADE,
    FOREIGN KEY (MaHocSinh) REFERENCES HOCSINH(MaHocSinh) ON DELETE CASCADE
);

-- Tạo bảng THAMSO
CREATE TABLE THAMSO (
    TuoiHocSinhToiThieu INT NOT NULL,
    TuoiHocSinhToiDa INT NOT NULL,
    SoLuongHocSinhToiDa INT NOT NULL,
    DiemToiDa FLOAT NOT NULL,
    DiemToiThieu FLOAT NOT NULL,
    DiemDat FLOAT NOT NULL
);

-- Tạo bảng MONHOC
CREATE TABLE MONHOC (
    MaMonHoc INT AUTO_INCREMENT PRIMARY KEY,
    TenMonHoc NVARCHAR(50) NOT NULL,
    DiemDatMonHoc FLOAT NOT NULL
);

-- Tạo bảng HOCKY
CREATE TABLE HOCKY (
    MaHocKy INT AUTO_INCREMENT PRIMARY KEY,
    TenHocKy NVARCHAR(50) NOT NULL
);

-- Tạo bảng BC_TKMH
CREATE TABLE BC_TKMH (
    MaBC_TKM INT AUTO_INCREMENT PRIMARY KEY,
    MaNamHoc VARCHAR(255) NOT NULL,
    MaMonHoc INT NOT NULL,
    MaHocKy INT NOT NULL,
    FOREIGN KEY (MaNamHoc) REFERENCES NAMHOC(MaNamHoc) ON DELETE CASCADE,
    FOREIGN KEY (MaMonHoc) REFERENCES MONHOC(MaMonHoc) ON DELETE CASCADE,
    FOREIGN KEY (MaHocKy) REFERENCES HOCKY(MaHocKy) ON DELETE CASCADE
);

-- Tạo bảng BC_TKHK
CREATE TABLE BC_TKHK (
    MaBC_TKHK INT AUTO_INCREMENT PRIMARY KEY,
    MaHocKy INT NOT NULL,
    MaDanhSachLop INT NOT NULL,
    SoLuongDat INT NOT NULL,
    TiLe FLOAT NOT NULL,
    FOREIGN KEY (MaHocKy) REFERENCES HOCKY(MaHocKy) ON DELETE CASCADE,
    FOREIGN KEY (MaDanhSachLop) REFERENCES DANHSACHLOP(MaDanhSachLop) ON DELETE CASCADE
);

-- Tạo bảng LOAIKIEMTRA
CREATE TABLE LOAIKIEMTRA (
    MaLKT INT AUTO_INCREMENT PRIMARY KEY,
    TenLKT NVARCHAR(50) NOT NULL,
    HeSo FLOAT NOT NULL
);

-- Tạo bảng BANGDIEM
CREATE TABLE BANGDIEM (
    MaBangDiem INT AUTO_INCREMENT PRIMARY KEY,
    MaCT_DSL INT NOT NULL,
    MaHocKy INT NOT NULL,
    DTBHK FLOAT NOT NULL,
    FOREIGN KEY (MaCT_DSL) REFERENCES CT_DSL(MaCT_DSL) ON DELETE CASCADE,
    FOREIGN KEY (MaHocKy) REFERENCES HOCKY(MaHocKy) ON DELETE CASCADE
);

-- Tạo bảng BD_MONHOC
CREATE TABLE BD_MONHOC (
    MaBD_MH INT AUTO_INCREMENT PRIMARY KEY,
    MaBangDiem INT NOT NULL,
    MaMonHoc INT NOT NULL,
    DTBMH FLOAT NOT NULL,
    FOREIGN KEY (MaBangDiem) REFERENCES BANGDIEM(MaBangDiem) ON DELETE CASCADE,
    FOREIGN KEY (MaMonHoc) REFERENCES MONHOC(MaMonHoc) ON DELETE CASCADE
);

-- Tạo bảng BD_THANHPHAN
CREATE TABLE BD_THANHPHAN (
    MaBD_TP INT AUTO_INCREMENT PRIMARY KEY,
    MaBD_MH INT NOT NULL,
    MaLKT INT NOT NULL,
    KetQua FLOAT NOT NULL,
    FOREIGN KEY (MaBD_MH) REFERENCES BD_MONHOC(MaBD_MH) ON DELETE CASCADE,
    FOREIGN KEY (MaLKT) REFERENCES LOAIKIEMTRA(MaLKT) ON DELETE CASCADE
);
